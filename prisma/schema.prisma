generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model LevelRole {
  id     String @id @default(uuid())
  level  Int    @unique
  roleId String
}

model XpBoost {
  id        String   @id @default(uuid())
  userId    String
  amount    Float
  expiresAt DateTime
}

model UserLevel {
  userId String @id @unique

  totalXp      Int      @default(0)
  currentXp    Int      @default(0)
  requiredXp   Int      @default(100)
  currentLevel Int      @default(0)
  xpBoost      Float    @default(0.0)
  lastXpEarned DateTime @default(now())

  bgImage           String?
  bgColor           String?
  borderColor       String?
  noBorder          Boolean?
  avatarBorderColor String?
  barColor          String?
  fontColor         String?
}

model User {
  idx             Int              @default(autoincrement())
  id              String           @id @unique
  badges          Badge[]
  titles          Title[]
  bio             String?          @db.VarChar(512)
  factionPosition FactionPosition?
  cash            Int              @default(100)
  bank            Int              @default(500)

  items Item[]

  faction   Faction? @relation(fields: [factionId], references: [id])
  factionId Int?
}

model Faction {
  id               Int           @id @default(autoincrement())
  badges           Badge[]
  titles           Title[]
  joinType         FactionStatus
  iconUrl          String
  name             String        @db.VarChar(32)
  description      String        @db.VarChar(512)
  ownerId          String
  pendingMemberIds String[]      @default([])
  members          User[]
}

model Item {
  id          String  @id @default(uuid())
  name        String
  description String
  usage       String
  usable      Boolean
  type        String
  emoji       String
  sellable    Boolean
  sellPrice   Int?
  value       String
  ownerId     String?
  price       Int
  owner       User?   @relation(fields: [ownerId], references: [id])
}

enum PrismaDropRarityType {
  legendary
  mythic
  gold
  silver
  bronze
}

enum Badge {
  BETA_TESTER
  ELITE_LEVEL
  AHA_BADGE
}

enum Title {
  BETA_TESTER
  ELITE_LEVEL
}

enum FactionPosition {
  OWNER
  SENIOR
  MEMBER
}

enum FactionStatus {
  OPEN
  CLOSED
  INVITE_ONLY
}
